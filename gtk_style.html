<!DOCTYPE html>
<html>
<head>
    <title>Priority Social Media</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
        .window { background: white; border: 1px solid #ccc; border-radius: 8px; padding: 20px; max-width: 600px; margin: 0 auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .entry { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        .button { background: #4a90e2; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        .button:hover { background: #357abd; }
        .feed { border: 1px solid #ccc; height: 200px; overflow-y: auto; padding: 10px; background: white; border-radius: 4px; margin: 10px 0; }
        .post { border-bottom: 1px solid #eee; padding: 10px 0; }
        .hidden { display: none; }
        .tabs { display: flex; margin: 10px 0; }
        .tab { background: #ddd; padding: 10px; cursor: pointer; border-radius: 4px 4px 0 0; margin-right: 2px; }
        .tab.active { background: #4a90e2; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        h2 { color: #333; text-align: center; }
        .user-list { max-height: 150px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; }
        .user-item { padding: 5px; border-bottom: 1px solid #eee; cursor: pointer; }
        .user-item:hover { background: #f0f0f0; }
    </style>
</head>
<body>
    <div class="window">
        <h2>Priority Social Media</h2>
        
        <div id="login-view">
            <input type="text" id="username" class="entry" placeholder="Username">
            <input type="password" id="password" class="entry" placeholder="Password">
            <button class="button" onclick="login()">Login</button>
            <button class="button" onclick="register()">Register</button>
        </div>
        
        <div id="main-view" class="hidden">
            <div class="tabs">
                <div class="tab active" onclick="showTab('feed')">Feed</div>
                <div class="tab" onclick="showTab('users')">Users</div>
                <div class="tab" onclick="showTab('messages')">Messages</div>
                <div class="tab" onclick="showTab('friends')">Friends</div>
                <div class="tab" onclick="showTab('notifications')">Notifications</div>
            </div>
            
            <div id="feed-tab" class="tab-content active">
                <input type="text" id="post-content" class="entry" placeholder="What's on your mind?">
                <button class="button" onclick="createPost()">Post</button>
                <div id="feed" class="feed"></div>
            </div>
            
            <div id="users-tab" class="tab-content">
                <input type="text" id="search-user" class="entry" placeholder="Search users..." oninput="searchUsers()">
                <div id="user-list" class="user-list"></div>
                <input type="number" id="follow-id" class="entry" placeholder="User ID to follow">
                <button class="button" onclick="followUser()">Follow</button>
                <button class="button" onclick="unfollowUser()">Unfollow</button>
            </div>
            
            <div id="messages-tab" class="tab-content">
                <input type="number" id="msg-user-id" class="entry" placeholder="User ID">
                <input type="text" id="msg-content" class="entry" placeholder="Message...">
                <button class="button" onclick="sendMessage()">Send</button>
                <div id="messages" class="feed"></div>
            </div>
            
            <div id="friends-tab" class="tab-content">
                <input type="number" id="friend-id" class="entry" placeholder="User ID">
                <button class="button" onclick="addCloseFriend()">Add Close Friend</button>
                <button class="button" onclick="removeCloseFriend()">Remove</button>
                <div id="close-friends" class="feed"></div>
            </div>
            
            <div id="notifications-tab" class="tab-content">
                <button class="button" onclick="updateNotifications()">Refresh</button>
                <div id="notifications" class="feed"></div>
            </div>
            
            <button class="button" onclick="logout()">Logout</button>
        </div>
        
        <div id="status" style="margin-top: 10px; color: #666; text-align: center;">Welcome! Please login or register.</div>
    </div>

    <script>
        let users = [];
        let posts = [];
        let messages = [];
        let follows = [];
        let closeFriends = [];
        let notifications = [];
        let currentUser = null;
        let nextUserId = 1;

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = user;
                document.getElementById('login-view').classList.add('hidden');
                document.getElementById('main-view').classList.remove('hidden');
                document.getElementById('status').textContent = `Welcome, ${username}!`;
                updateFeed();
                updateUserList();
            } else {
                document.getElementById('status').textContent = 'Login failed!';
            }
        }

        function register() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (users.find(u => u.username === username)) {
                document.getElementById('status').textContent = 'Username already exists!';
                return;
            }
            
            users.push({ id: nextUserId++, username, password, createdAt: new Date() });
            document.getElementById('status').textContent = 'Registration successful! Please login.';
        }

        function createPost() {
            const content = document.getElementById('post-content').value;
            if (content && currentUser) {
                const isCloseFriend = closeFriends.some(cf => cf.userId === currentUser.id);
                posts.unshift({ 
                    id: posts.length + 1,
                    authorId: currentUser.id,
                    author: currentUser.username, 
                    content, 
                    time: new Date(),
                    priority: isCloseFriend ? 1 : 0
                });
                document.getElementById('post-content').value = '';
                updateFeed();
                addNotification(`${currentUser.username} created a new post`);
            }
        }

        function updateFeed() {
            const priorityPosts = posts.filter(p => p.priority === 1);
            const regularPosts = posts.filter(p => p.priority === 0);
            
            const feed = document.getElementById('feed');
            const allPosts = [...priorityPosts, ...regularPosts];
            feed.innerHTML = allPosts.map(post => 
                `<div class="post">
                    <strong>@${post.author}</strong> ${post.priority ? '⭐' : ''}<br>
                    ${post.content}<br>
                    <small>${post.time.toLocaleString()}</small>
                </div>`
            ).join('');
        }

        function searchUsers() {
            const search = document.getElementById('search-user').value.toLowerCase();
            const filtered = users.filter(u => u.username.toLowerCase().includes(search));
            updateUserList(filtered);
        }

        function updateUserList(userList = users) {
            const list = document.getElementById('user-list');
            list.innerHTML = userList.map(user => 
                `<div class="user-item" onclick="selectUser(${user.id})">
                    @${user.username} (ID: ${user.id})
                    ${isFollowing(user.id) ? ' - Following' : ''}
                    ${isCloseFriend(user.id) ? ' ⭐' : ''}
                </div>`
            ).join('');
        }

        function selectUser(userId) {
            document.getElementById('follow-id').value = userId;
            document.getElementById('msg-user-id').value = userId;
            document.getElementById('friend-id').value = userId;
        }

        function followUser() {
            const userId = parseInt(document.getElementById('follow-id').value);
            if (userId && userId !== currentUser.id && !isFollowing(userId)) {
                follows.push({ followerId: currentUser.id, followingId: userId });
                updateUserList();
                addNotification(`${currentUser.username} started following you`, userId);
            }
        }

        function unfollowUser() {
            const userId = parseInt(document.getElementById('follow-id').value);
            follows = follows.filter(f => !(f.followerId === currentUser.id && f.followingId === userId));
            updateUserList();
        }

        function isFollowing(userId) {
            return follows.some(f => f.followerId === currentUser.id && f.followingId === userId);
        }

        function sendMessage() {
            const receiverId = parseInt(document.getElementById('msg-user-id').value);
            const content = document.getElementById('msg-content').value;
            
            if (receiverId && content && currentUser) {
                const priority = isCloseFriend(receiverId) ? 1 : 0;
                messages.push({
                    id: messages.length + 1,
                    senderId: currentUser.id,
                    receiverId,
                    sender: currentUser.username,
                    content,
                    time: new Date(),
                    priority
                });
                document.getElementById('msg-content').value = '';
                updateMessages();
                addNotification(`New message from ${currentUser.username}`, receiverId);
            }
        }

        function updateMessages() {
            const userMessages = messages.filter(m => 
                m.senderId === currentUser.id || m.receiverId === currentUser.id
            );
            
            const priorityMsgs = userMessages.filter(m => m.priority === 1);
            const regularMsgs = userMessages.filter(m => m.priority === 0);
            
            const msgDiv = document.getElementById('messages');
            const allMsgs = [...priorityMsgs, ...regularMsgs];
            msgDiv.innerHTML = allMsgs.map(msg => {
                const direction = msg.senderId === currentUser.id ? '→' : '←';
                const otherUser = users.find(u => u.id === (msg.senderId === currentUser.id ? msg.receiverId : msg.senderId));
                return `<div class="post">
                    ${direction} @${otherUser ? otherUser.username : 'Unknown'} ${msg.priority ? '⭐' : ''}<br>
                    ${msg.content}<br>
                    <small>${msg.time.toLocaleString()}</small>
                </div>`;
            }).join('');
        }

        function addCloseFriend() {
            const friendId = parseInt(document.getElementById('friend-id').value);
            if (friendId && friendId !== currentUser.id && isFollowing(friendId) && !isCloseFriend(friendId)) {
                closeFriends.push({ userId: currentUser.id, friendId });
                updateCloseFriends();
                updateUserList();
            }
        }

        function removeCloseFriend() {
            const friendId = parseInt(document.getElementById('friend-id').value);
            closeFriends = closeFriends.filter(cf => !(cf.userId === currentUser.id && cf.friendId === friendId));
            updateCloseFriends();
            updateUserList();
        }

        function isCloseFriend(friendId) {
            return closeFriends.some(cf => cf.userId === currentUser.id && cf.friendId === friendId);
        }

        function updateCloseFriends() {
            const userCloseFriends = closeFriends.filter(cf => cf.userId === currentUser.id);
            const friendsDiv = document.getElementById('close-friends');
            friendsDiv.innerHTML = userCloseFriends.map(cf => {
                const friend = users.find(u => u.id === cf.friendId);
                return `<div class="post">⭐ @${friend ? friend.username : 'Unknown'} (ID: ${cf.friendId})</div>`;
            }).join('');
        }

        function addNotification(content, userId = null) {
            const targetUsers = userId ? [userId] : follows.filter(f => f.followingId === currentUser.id).map(f => f.followerId);
            targetUsers.forEach(uid => {
                const priority = isCloseFriend(uid) ? 1 : 0;
                notifications.push({
                    id: notifications.length + 1,
                    userId: uid,
                    content,
                    time: new Date(),
                    priority,
                    read: false
                });
            });
        }

        function updateNotifications() {
            const userNotifs = notifications.filter(n => n.userId === currentUser.id);
            const priorityNotifs = userNotifs.filter(n => n.priority === 1);
            const regularNotifs = userNotifs.filter(n => n.priority === 0);
            
            const notifsDiv = document.getElementById('notifications');
            const allNotifs = [...priorityNotifs, ...regularNotifs];
            notifsDiv.innerHTML = allNotifs.map(notif => 
                `<div class="post" onclick="markRead(${notif.id})">
                    ${notif.read ? '' : '●'} ${notif.priority ? '⭐' : ''} ${notif.content}<br>
                    <small>${notif.time.toLocaleString()}</small>
                </div>`
            ).join('');
        }

        function markRead(notifId) {
            const notif = notifications.find(n => n.id === notifId);
            if (notif) notif.read = true;
            updateNotifications();
        }

        function logout() {
            currentUser = null;
            document.getElementById('main-view').classList.add('hidden');
            document.getElementById('login-view').classList.remove('hidden');
            document.getElementById('status').textContent = 'Logged out';
        }

        // Initialize with sample data
        users.push({ id: 1, username: 'alice', password: '123', createdAt: new Date() });
        users.push({ id: 2, username: 'bob', password: '123', createdAt: new Date() });
        nextUserId = 3;
    </script>
</body>
</html>